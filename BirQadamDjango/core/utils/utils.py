"""
–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
"""
import logging
from typing import Optional

logger = logging.getLogger(__name__)


def normalize_phone(phone: Optional[str]) -> Optional[str]:
    """
    –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫ —Ñ–æ—Ä–º–∞—Ç—É +7XXXXXXXXXX (–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω)
    
    –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: +7 7XX XXX XX XX (12 —Å–∏–º–≤–æ–ª–æ–≤: '+7' + 10 —Ü–∏—Ñ—Ä)
    
    –ü—Ä–∏–º–µ—Ä—ã:
    - 87012345678 (11 —Ü–∏—Ñ—Ä) ‚Üí +77012345678 (12 —Å–∏–º–≤–æ–ª–æ–≤)
    - 77012345678 (11 —Ü–∏—Ñ—Ä) ‚Üí +77012345678 (12 —Å–∏–º–≤–æ–ª–æ–≤)
    - 7012345678 (10 —Ü–∏—Ñ—Ä) ‚Üí +77012345678 (12 —Å–∏–º–≤–æ–ª–æ–≤)
    - +77012345678 ‚Üí +77012345678
    - 8 (701) 234-56-78 ‚Üí +77012345678
    
    Args:
        phone (str): –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –ª—é–±–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
    
    Returns:
        str: –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7XXXXXXXXXX
    """
    if not phone:
        return phone
    
    # –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã, —Å–∫–æ–±–∫–∏, –¥–µ—Ñ–∏—Å—ã
    phone = phone.replace(' ', '').replace('(', '').replace(')', '').replace('-', '')
    
    # –£–¥–∞–ª—è–µ–º + –≤ –Ω–∞—á–∞–ª–µ –¥–ª—è —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏
    if phone.startswith('+'):
        phone = phone[1:]
    
    # –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å —Ü–∏—Ñ—Ä–∞–º–∏
    # –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω—Å–∫–∏–µ –Ω–æ–º–µ—Ä–∞: –∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã 7, –∫–æ–¥ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ 7XX, –¥–∞–ª–µ–µ 7 —Ü–∏—Ñ—Ä
    
    # –ï—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 8 (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç, 11 —Ü–∏—Ñ—Ä), –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ 7
    if phone.startswith('8') and len(phone) == 11:
        # 87XXXXXXXXX (11 —Ü–∏—Ñ—Ä) ‚Üí 77XXXXXXXXX ‚Üí +77XXXXXXXXX
        phone = '7' + phone[1:]
    
    # –¢–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–æ–º–µ—Ä–∞, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å 7
    if phone.startswith('77') and len(phone) == 11:
        # 77XXXXXXXXX (11 —Ü–∏—Ñ—Ä) ‚Üí +77XXXXXXXXX
        phone = '+' + phone
    elif phone.startswith('7') and len(phone) == 11:
        # 7XXXXXXXXXX (11 —Ü–∏—Ñ—Ä, –ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä) ‚Üí +7XXXXXXXXXX
        phone = '+' + phone
    elif phone.startswith('7') and len(phone) == 10:
        # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: 7XXXXXXXXX (10 —Ü–∏—Ñ—Ä, –Ω–µ–ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä) ‚Üí +77XXXXXXXXX
        phone = '+77' + phone[1:]  # –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—É—é "7" –∏ –¥–æ–±–∞–≤–ª—è–µ–º "+77"
    elif len(phone) == 10:
        # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: XXXXXXXXXX (10 —Ü–∏—Ñ—Ä –±–µ–∑ –∫–æ–¥–∞) ‚Üí +77XXXXXXXXX
        phone = '+77' + phone
    elif not phone.startswith('+'):
        # –õ—é–±–æ–π –¥—Ä—É–≥–æ–π —Å–ª—É—á–∞–π - –¥–æ–±–∞–≤–ª—è–µ–º +7
        phone = '+7' + phone
    
    logger.debug(f"üì± –ù–æ–º–µ—Ä –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω: {phone} (–¥–ª–∏–Ω–∞: {len(phone)})")
    return phone
